\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{Bioconductor}[2013/07/01 Bioconductor vignette style]
% 
\PassOptionsToPackage{usenames,dvipsnames}{color}
\RequirePackage{color}
\definecolor{BiocBlue}{RGB}{24,129,194}
\definecolor{BiocGreen}{RGB}{135,177,63}
\definecolor{BiocGray}{cmyk}{0,0,0,0.50}
\definecolor{BiocMagenta}{rgb}{1, 0, 1}
\definecolor{BiocRed}{rgb}{1, 0, 0}
\definecolor{BiocBittersweet}{cmyk}{0,0.75,1,0.24}
\definecolor{codecolor}{RGB}{64,64,64}
%
\RequirePackage[%
 pdfpagelabels,%
 plainpages=false,%
 pdfborder={0 0 0},%
 bookmarks=true,%
 bookmarksopen=true,%
 bookmarksnumbered=true,%
 colorlinks,%
 breaklinks,%
 linkcolor=BiocBlue,%
 citecolor=BiocBlue,%
 anchorcolor=BiocBlue,%
 urlcolor=BiocBlue,%
 citebordercolor={.7 .7 .7},%
 linkbordercolor={.7 .7 .7},%
 urlbordercolor={.7 .7 .7},%
 raiselinks,%
 pdfusetitle,%
 pdftex]{hyperref}
\urlstyle{same}  % don't use monospace font for urls
\pdfpageattr{/Group << /S /Transparency /I true /CS /DeviceRGB>>} %fixes incorrect color rendering in acroread
% Define page layout
\RequirePackage{geometry}
\newlength\widthdiff
\setlength\widthdiff{-210mm}
\advance\widthdiff\paperwidth
\newlength\leftoffset
\setlength\leftoffset{35mm}
%\advance\leftoffset.5\widthdiff
\newlength\hfskip
\setlength\hfskip{15mm}
\newlength\margin
\setlength\margin{20mm}
%
\newlength\layoutw
\setlength\layoutw{210mm}
\newlength\layouth
\setlength\layouth{11in}
\newlength\layouthoff
\newlength\layoutvoff
\setlength\layouthoff\paperwidth
\setlength\layoutvoff\paperheight
\advance\layouthoff-\layoutw
\advance\layoutvoff-\layouth
\geometry{%
% showframe,%
% page layout equals common area of letter and A4
 layoutsize={\layoutw,\layouth},%
 layouthoffset=.5\layouthoff,%
 centering=true,%
 total={120mm,210mm},%
 marginparsep=5mm,%
 marginparwidth=30mm,%
 left=35mm,%
 right=55mm,%
 %top=35mm,%
 headheight=\hfskip,%
 headsep=0mm,%
 footskip=\hfskip%
}
\newlength{\overhang}
\setlength{\overhang}{15mm}
\newlength{\rightoffset} % right offset of the document body
\setlength{\rightoffset}{35mm}
\newlength{\capoffset} % right offset of the caption relative to the width of the float
% capoffset is reset for each float environment
\newlength{\fltoffset} % left offset of floats relative to paragraph text
\setlength{\fltoffset}{20mm} 
%% Use Latin Modern Sans Serif font
\renewcommand\familydefault\sfdefault
\renewcommand\sfdefault{lmss}
%% Beramono font for TT font
\RequirePackage[scaled=0.8]{beramono}
\RequirePackage[T1]{fontenc}
%
\RequirePackage[newlinetospace]{titlesec}
\RequirePackage{etoolbox}
%% Font definitions
\def\mdhelvet{\fontfamily{phv}\selectfont\mdseries}
\def\bfhelvet{\fontfamily{phv}\selectfont\bfseries}
%
\def\titlefont{\mdhelvet\color{BiocBlue}}
% Section
\titleformat{\section}
{\LARGE\titlefont}
{\makebox[\overhang][l]{\thesection}}{0in}{}
[\vspace{-.2ex}\titlerule]
% Section, numberless
\titleformat{name=\section,numberless}
{\LARGE\titlefont}
{}{0in}{}
% Subsection and Subsubsection
\titlelabel{\makebox[\overhang][l]{\thetitle}}
\titleformat*{\subsection}{\Large\titlefont}
\titleformat*{\subsubsection}{\large\titlefont}
%
\titlespacing{\section}{-\overhang}{*3.5}{*2.5}
\titlespacing{\subsection}{-\overhang}{*3.25}{*1.5}
\titlespacing{\subsubsection}{-\overhang}{*3.25}{*1.5}
%
% Flush left titles that are not numbered
%\let\@contentsname\contentsname
%\renewcommand{\contentsname}{\hspace{-\overhang}\@contentsname}
%\let\@refname\refname
%\renewcommand{\refname}{\hspace{-\overhang}\@refname}
% \RequirePackage{sectsty}
% \titlefont{\sffamily\bfseries\color{BiocBlue}\sectionrule{0pt}{0pt}{-1ex}{1pt}}
% \subtitlefont{\sffamily\bfseries\color{BiocBlue}}
% \subsubtitlefont{\sffamily\bfseries\color{BiocBlue}}
%% Code and output chunks
\RequirePackage{framed}
%\fboxsep=0mm
\RequirePackage{ifthen}
\definecolor{shadecolor}{RGB}{240,240,240}
\newlength{\voverhang}
\setlength\voverhang{\overhang}
%% The implementation of the following environment is based on snugshade* from the package framed
\OuterFrameSep=0mm
\newenvironment{myshaded}{%
  \def\FrameCommand##1{\fboxsep=1em%
   \hskip-\voverhang \hskip\@totalleftmargin
   \colorbox{shadecolor}{\hskip\voverhang \hskip-\fboxsep ##1}%
      % There is no \@totalrightmargin, so:
      \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
  \MakeFramed {\advance\hsize\fboxsep \advance\hsize-\width
    \@totalleftmargin\z@ \linewidth\hsize
    \advance\labelsep\fboxsep
    \@setminipage}%
 }{\par\unskip\@minipagefalse\endMakeFramed}
%% Code chunks styling
% Sweave
\newenvironment{Schunk}{\begin{myshaded}}{\end{myshaded}}
% knitr
\ifdefined\kframe\renewenvironment{kframe}{\begin{myshaded}}{\end{myshaded}}\fi
%% Title
\let\@bioctitle\@empty
\let\@oldtitle\title
\renewcommand{\title}[1]{\def\@bioctitle{#1}\@oldtitle{#1}}
\newcommand{\bioctitle}[2][]{\@oldtitle{#2}%
  \def\tmp{#1}\ifx\tmp\@empty\def\@bioctitle{#2}\else\def\@bioctitle{#1}\fi}
%% Page layout
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{} % clear all header and footer fields
%\fancyhead[LE,RO]{\thepage}
\fancyhead[LO,RE]{\parbox[b][\hfskip][t]{\headwidth}{\bfhelvet\@bioctitle}}
\fancyhfoffset[L]{\overhang}
\fancyhfoffset[R]{\rightoffset}
\renewcommand{\headrule}{}
\fancyfoot[R]{\bfhelvet\thepage}
%
\RequirePackage{enumitem}
\setlist[itemize]{label=\color{BiocBlue}\textbullet}
%
\RequirePackage{parskip}
%% Alter some LaTeX defaults for better treatment of floats
%% See p.105 of "TeX Unbound" for suggested values
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\setcounter{totalnumber}{4}
\setcounter{dbltopnumber}{2}
\renewcommand\topfraction{0.9}
\renewcommand\bottomfraction{0.5}
\renewcommand\textfraction{0.1}
\renewcommand\floatpagefraction{0.9}
\renewcommand\dbltopfraction{0.9}
\renewcommand\dblfloatpagefraction{0.8}
%
%% Title page
\renewcommand{\maketitle}{%
%\begin{titlepage}
\thispagestyle{empty}
\begin{adjustwidth}{-\overhang}{0mm}
 {\huge\bfhelvet\color{BiocBlue}\@title\unskip\strut\par}
\end{adjustwidth}
\addvspace{3.5ex plus 0.5ex minus 0.25ex}
{\@author\unskip\strut\par}
\addvspace{2.5ex plus 0.5ex minus 0.25ex}
{\large\bfseries\@date\unskip\strut\par}
\addvspace{1.5ex plus 0.25ex minus 0.15ex}
%\end{titlepage}
}
%% Support author affiliations
\RequirePackage[noblocks]{authblk}
\renewcommand\Authfont{\Large\bfseries\itshape}
\renewcommand\Affilfont{\normalsize\mdseries\upshape}
%% Abstract
\renewenvironment{abstract}%
{{\bfhelvet\hskip-\overhang\abstractname\unskip\strut\par}}%
{\vspace{1.5ex plus 0.25ex minus 0.15ex}}
%%
\newcommand{\email}[1]{\href{mailto:#1}{\texttt{#1}}}
\newcommand{\file}[1]{'#1'}
%
\newcommand{\software}[1]{\textsl{#1}}
\newcommand\R{\software{R}}
%
\newcommand\Bioconductor{\software{Bioconductor}}
\newcommand{\Rpackage}[1]{\textsl{#1}}
\newcommand\Biocpkg[1]{%
  {\href{http://bioconductor.org/packages/#1}%
    {\Rpackage{#1}}}}
\newcommand\Biocannopkg[1]{\Biocpkg{#1}}
\newcommand\Biocexptpkg[1]{\Biocpkg{#1}}
\newcommand\CRANpkg[1]{%
  {\href{http://cran.fhcrc.org/web/packages/#1/index.html}%
    {\Rpackage{#1}}}}
\newcommand\Githubpkg[1]{\GithubSplit#1\relax}
\def\GithubSplit#1/#2\relax{{\href{https://github.com/#1/#2}%
    {\Rpackage{#2}}}}
%
\RequirePackage{soul} %inline code highligting
\sethlcolor{shadecolor}
% fine-tune inline code highlighting
\makeatletter
\def\SOUL@hlpreamble{%
 \setul{}{2.05ex}% default is 2.5ex
 \SOUL@stpreamble
 \dimen@\SOUL@ulthickness
 \dimen@i=-.575ex% default is -.5ex
 \advance\dimen@i-.5\dimen@
 \edef\SOUL@uldepth{\the\dimen@i}%
 \let\SOUL@ulcolor\SOUL@hlcolor
 \SOUL@ulpreamble
}
\makeatother
%
% override knitr color definitions
%
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{0, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\definecolor{functioncolor}{RGB}{224, 128, 32}
%
\renewcommand{\texttt}[2][codecolor]{\textcolor{#1}{\hl{\ttfamily#2}}}
\newcommand{\Rcode}[1]{\texttt{#1}}
\newcommand{\Rfunction}[1]{\textbf{\texttt[functioncolor]{#1}}}
\newcommand{\Robject}[1]{\Rcode{#1}}
\newcommand{\Rclass}[1]{\textit{#1}}
%
\newcommand{\bioccomment}[1]{\textsl{\textcolor{BiocGray}{comment: #1}}}
\newcommand{\warning}[1]{\textsl{\textcolor{BiocMagenta}{warning: #1}}}
\newcommand{\fixme}[1]{\textsl{\textcolor{BiocBittersweet}{fixme: #1}}}
%
\newcommand{\prefix}[1]{#1}
\newcommand{\incfig}[5][tbp]{%
  \begin{figure}[#1]%
  \begin{center}%
  \includegraphics[width=#3]{\prefix{#2}}%
  \caption[#4]{\label{#2}\textbf{#4} #5}%
  \end{center}%
  \end{figure}%
}
%%
% The placeins package provides the \FloatBarrier command.  This forces
% LaTeX to place all of the floats before proceeding.  We'll use this to
% keep the float (figure and table) numbers in sequence.
\RequirePackage[section]{placeins}
%
\newcommand\package[1]{{\bfhelvet\hskip-\overhang Package version:} #1\unskip\strut\par}
% Author block
\RequirePackage[noblocks]{authblk}
% Footnotes on margin
\RequirePackage{ragged2e}% expose \RaggedRight to 'footmisc' to allowing hyphenation
\RequirePackage[side, ragged, flushmargin]{footmisc}
%
%% FLOATS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
% set figure dimensions
\RequirePackage{graphicx}
\makeatletter
\def\figwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\figheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\figwidth,height=\figheight,keepaspectratio}
%
\def\fps@figure{htbp}
\def\fps@table{htbp}
%
\RequirePackage[strict]{changepage}
%
% Uses the approach http://stackoverflow.com/questions/1565988/making-a-small-modification-to-a-latex-environment
%
\newenvironment{@biocfloat}[4][]%[position]{type}{capoffset}{rightoffset}
{\setlength\capoffset{#3}%
\edef\@tempa{\noexpand\@float{#2}[#1]}
\@tempa\begin{adjustwidth}{\fltoffset}{#4}}%
{\end{adjustwidth}\end@float}
%
\newenvironment{@biocfloat@regular}[2][]%[position]{type}
{\begin{@biocfloat}[#1]{#2}{-\rightoffset}{0in}}
{\end{@biocfloat}}
%
\newenvironment{@biocfloat@wide}[2][]%[position]{type}
{\begin{@biocfloat}[#1]{#2}{0in}{-\rightoffset}}
{\end{@biocfloat}}
%
\newenvironment{@biocfloat@small}[2][]%[position]{type}
{\begin{@biocfloat}[#1]{#2}{-\rightoffset}{\rightoffset}}
{\end{@biocfloat}}
%
\renewenvironment{table}[1][\fps@table]
{\begin{@biocfloat@regular}[#1]{table}}
{\end{@biocfloat@regular}}
%
\renewenvironment{table*}[1][\fps@table]
{\begin{@biocfloat@wide}[#1]{table}}
{\end{@biocfloat@wide}}
%
\renewenvironment{figure}[1][\fps@figure]
{\begin{@biocfloat@regular}[#1]{figure}}
{\end{@biocfloat@regular}}
%
\renewenvironment{figure*}[1][\fps@figure]
{\begin{@biocfloat@wide}[#1]{figure}}
{\end{@biocfloat@wide}}
%
\newenvironment{smallfigure}[1][\fps@figure]
{\begin{@biocfloat@small}[#1]{figure}}
{\end{@biocfloat@small}}
\makeatother
%
%% Captions
%
\RequirePackage{caption}
\DeclareCaptionFont{bfhelvet}{\bfhelvet}
\captionsetup{%
 font=footnotesize,%
 labelfont=bfhelvet,%
 justification=RaggedRight,%
 singlelinecheck=false,%
}
%% make first sentence of caption bold
\RequirePackage{xstring}
%
% Regular expression extracting the first sentence
% \RequirePackage{l3regex}
% \ExplSyntaxOn
% \tl_new:N \l_demo_tl
% \cs_new:Npn \demo #1 {
%     \tl_set:Nn \l_demo_tl {#1}
%     \regex_replace_once:nnN { (.*?)[\.\;\:](.*) } { \c{adjustedcaption}\cB\{ \1 \cE\}\cB\{ \2 \cE\} } \l_demo_tl
%     \tl_use:N \l_demo_tl
% }
% \ExplSyntaxOff
%
\makeatletter
\newcommand\formatcaption[2]{{\bfhelvet\color{BiocBlue}#1}\newline#2}
  \newcommand*{\orgcaption}{}%
  \let\orgcaption\caption
  \def\caption{\@ifnextchar[{\@withcap}{\@withoutcap}}
  \def\@withcap[#1]#2{\orgcaption[#1]{\formatcaption{#1}{#2}}}
  \def\@withoutcap#1{%
    \noexpandarg
      \IfSubStr{#1}{.}{%
        \StrBefore{#1}{.}[\firstcaption]%
        \StrBehind{#1}{.}[\secondcaption]%
      }{%
      \def\firstcaption{#1}%
      \def\secondcaption{}%
      }%
    \begin{adjustwidth}{0mm}{\capoffset}%
    \orgcaption[\firstcaption]{\formatcaption{\firstcaption}{\secondcaption}}%
    \end{adjustwidth}
  }
\makeatother
%
% TOC
%
% styling
%
\RequirePackage{titletoc}
%
\def\pagefont{\normalsize\mdhelvet\color{black}}
%
\newlength{\rightextend}
%\setlength{\rightextend}{20mm}
\setlength{\rightextend}{0mm}
%
%\contentsmargin[5mm]{5mm}
%
% \titlecontents{section}[0mm]%
% {\Large\titlefont}%
% {\contentslabel{\secindent}}{}{\hfill\pagefont\contentspage}%
\titlecontents{section}[10mm]%
{\addvspace{2.5ex}\Large\titlefont}%
{\contentslabel{10mm}}{}{\hfill\pagefont\contentspage\hspace*{-\rightextend}}
[\addvspace{-.3ex}\titleline{\hspace*{0mm}\titlerule\hspace*{-\rightextend}}\addvspace{.3ex}\addvspace{1.0ex}]
%
\titlecontents{subsection}[22mm]%
{\addvspace{1.0ex}\large\titlefont}%
{\contentslabel{12mm}}{}{\pagefont\titlerule*[9pt]{.}\contentspage\hspace*{-\rightextend}}
%
\titlecontents{subsubsection}[35mm]%
{\normalfont\titlefont}%
{\contentslabel{13mm}}{}{\pagefont\titlerule*[9pt]{.}\contentspage\hspace*{-\rightextend}}
%
% Equation numbering
% 
\usepackage[leqno]{mathtools}
\newtagform{brackets}[\setlength{\fboxsep}{1pt}\bfhelvet\small\color{white}\fcolorbox{BiocBlue}{BiocBlue}]{}{}
\usetagform{brackets}
\let\eqreforg\eqref
\renewcommand{\eqref}[1]{\hypersetup{linkcolor=white}\eqreforg{#1}\hypersetup{linkcolor=BiocBlue}}
%
% References
%
\makeatletter
\renewcommand{\@biblabel}[1]{[#1]\hfill}
\makeatother
\let\thebibliographyorg\thebibliography
\def\thebibliography{\raggedright\thebibliographyorg}
%
\endinput
